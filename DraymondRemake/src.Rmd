---
title: "538 Recreation"
author: "Adam Walters"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(knitr)
library(kableExtra) #printing table
library(grDevices)
library(tidyverse)
library(formattable) #formating
library(DT) #formating
library(grDevices)  # For colorRampPalette
library(viridisLite)  # For viridis palette
library(scales)       # For rescale function

# Read the dataset
draymond_data <- read.csv("draymond.csv")
```

# Table 1 


```{r}

# Aggregate data by player (calculating total possessions and average DRAYMOND separately)
aggregated_data <- aggregate(possessions ~ player, data = draymond_data, FUN = sum)
aggregated_data$DRAYMOND <- aggregate(DRAYMOND ~ player, data = draymond_data, FUN = mean)$DRAYMOND

# At least 10,000 possessions played
filtered_data <- aggregated_data[aggregated_data$possessions >= 10000, ]

# Data in descending order
filtered_data <- filtered_data[order(filtered_data$DRAYMOND, decreasing = TRUE), ]

# Define the color gradient
spec_color2 <- function(x, alpha = 1, begin = c(0, 0, 1), middle = c(1, 1, 1), end = c(1, 0, 1), na_color = "#BBBBBB", scale_from = NULL) {
  n <- length(x)
  if (is.null(scale_from)) {
    x <- scales::rescale(x, c(0, 1))
  } else {
    x <- scales::rescale(x, to = c(0, 1), from = scale_from)
  }
  
  red <- c(seq(begin[1], middle[1], length.out = n/2), seq(middle[1], end[1], length.out = n/2))
  green <- c(seq(begin[2], middle[2], length.out = n/2), seq(middle[2], end[2], length.out = n/2))
  blue <- c(seq(begin[3], middle[3], length.out = n/2), seq(middle[3], end[3], length.out = n/2))
  
  color_code <- grDevices::rgb(red = red, green = green, blue = blue, alpha = alpha)
  color_code[is.na(color_code)] <- na_color
  return(color_code)
}

# Apply the color gradient to the DRAYMOND column
filtered_data$DRAYMOND_color <- spec_color2(filtered_data$DRAYMOND, begin = c(0, 0, 1), middle = c(1, 1, 1), end = c(1, 0, 1))

# Print the table with kable
kable(
  filtered_data[, c("player", "possessions", "DRAYMOND")],
  col.names = c("PLAYER", "POSSESSIONS PLAYED", "DRAYMOND RATING"),
  format = "html",
  escape = FALSE, row.names = FALSE
) %>%
  kable_styling() %>%
  column_spec(3, background = filtered_data$DRAYMOND_color)

```


# Table 2: 

```{r}
# Filter the dataset for the 2019 season
season_2019_data <- draymond_data[draymond_data$season == "2019", ]

# Filter for players with a minimum of 2,000 possessions played
filtered_data <- season_2019_data[season_2019_data$possessions >= 2000, ]

# Sort the positive and negative data by DRAYMOND defensive ratings
draymond_positive <- filtered_data[filtered_data$DRAYMOND > 0, ]
draymond_negative <- filtered_data[filtered_data$DRAYMOND < 0, ]


draymond_positive <- draymond_positive[order(draymond_positive$DRAYMOND), ]
draymond_negative <- draymond_negative[order(draymond_negative$DRAYMOND, decreasing = TRUE), ]

# Define color gradient palettes
blue_palette <- colorRampPalette(c("#FFFFFF", "#005fff"))
pink_palette <- colorRampPalette(c("#FFFFFF", "#ff69b4"))

# Apply gradient to each subset
draymond_positive$DRAYMOND_color <- blue_palette(nrow(draymond_positive))
draymond_negative$DRAYMOND_color <- pink_palette(nrow(draymond_negative))

# Combine 
colored_data <- rbind(draymond_positive, draymond_negative)

# Sort the combined data
sorted_data <- colored_data[order(colored_data$DRAYMOND, decreasing = TRUE), ]

# spec_color2 function
spec_color2 <- function(x, alpha = 1, begin = c(0, 0, 1), middle = c(1, 1, 1), end = c(1, 0, 1), na_color = "#BBBBBB", scale_from = NULL) {
  n <- length(x)
  if (is.null(scale_from)) {
    x <- scales::rescale(x, c(0, 1))
  } else {
    x <- scales::rescale(x, to = c(0, 1), from = scale_from)
  }
  
  red <- c(seq(begin[1], middle[1], length.out = n/2), seq(middle[1], end[1], length.out = n/2))
  green <- c(seq(begin[2], middle[2], length.out = n/2), seq(middle[2], end[2], length.out = n/2))
  blue <- c(seq(begin[3], middle[3], length.out = n/2), seq(middle[3], end[3], length.out = n/2))
  
  color_code <- grDevices::rgb(red = red, green = green, blue = blue, alpha = alpha)
  color_code[is.na(color_code)] <- na_color
  return(color_code)
}

# Apply gradient to the DRAYMOND column
sorted_data$DRAYMOND_color <- spec_color2(sorted_data$DRAYMOND, begin = c(0, 0, 1), middle = c(1, 1, 1), end = c(1, 0, 1))

# Print the table
kable(
  sorted_data[, c("player", "possessions", "DRAYMOND")], 
  col.names = c("PLAYER", "POSSESSIONS PLAYED", "DRAYMOND RATING"),
  escape = FALSE,
  row.names = FALSE
) %>%
  kable_styling() %>%
  column_spec(3, background = sorted_data$DRAYMOND_color)

```

